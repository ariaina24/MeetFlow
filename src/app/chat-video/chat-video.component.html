<div class="container">
  <div class="chat-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <div>
          <h1 class="title"><strong><span>MEET<span>FLOW</span></span> ðŸŽ¥</strong></h1>
          <span class="admin-name">{{ authService.getUserName() }}</span>
        </div>
        <button (click)="openProfileModal()">
          <img [src]="photoUrl" alt="Photo de profil" class="profil-pic-sidebar" />
        </button>
      </div>

      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Enter name to search...</mat-label>
          <input matInput>
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-list class="contact-list">
        <mat-list-item
          *ngFor="let contact of contacts"
          class="contact-item"
          (click)="selectUser(contact)"
        >
          <div>
            <div mat-line class="contact-name">{{ contact.firstName }} {{ contact.lastName }}</div>
            <div mat-line class="contact-message">Last message preview...</div>
          </div>
        </mat-list-item>
      </mat-list>

      <div class="sidebar-footer">
        <button mat-button [matMenuTriggerFor]="userMenu" class="profile-menu-btn">
          <mat-icon>account_circle</mat-icon>
          <span>Mon compte</span>
        </button>

        <mat-menu #userMenu="matMenu">
          <button mat-menu-item (click)="openProfileModal()">
            <mat-icon>person</mat-icon>
            <span>Profil</span>
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>DÃ©connexion</span>
          </button>
        </mat-menu>
      </div>

    </div>

    <div class="chat-area">
      <div *ngIf="!selectedUser" class="empty-chat animated-prompt">
        <h1 class="title">ðŸ‘‹ Bienvenu sur <strong><span>MEET<span>FLOW</span></span> ðŸŽ¥</strong></h1>
        <p class="typing-effect">ðŸ‘ˆ Cliquez sur un contact pour commencer Ã  discuter !</p>
        <div class="wave-hand">ðŸ‘‹</div>
      </div>

      <ng-container *ngIf="selectedUser">
        <div class="chat-header">
          <img src="images/default-men.jpg" alt="profil" class="profil-pic">
          <h1>{{ selectedUser.firstName }} {{ selectedUser.lastName }}</h1>
          <span class="status"></span>
        </div>

        <div #scrollContainer class="messages-container">
          <div *ngIf="selectedUser && messages.length === 0" class="empty-chat animated-prompt">
            <p>ðŸ’¬ Vous n'avez pas encore Ã©changÃ© de messages avec <strong>{{ selectedUser.firstName }}</strong>.</p>
            <p class="bounce-text">ðŸ‘‰ Envoyez votre premier message pour commencer la discussion !</p>
            <div class="wave-hand">ðŸ‘‹</div>
          </div>

          <div *ngFor="let group of groupedMessages">
            <div class="date-separator">{{ group.date }}</div>

            <div *ngFor="let msg of group.messages" class="message-row" [ngClass]="{'sent': msg.isSent}">
              <div class="message-avatar" *ngIf="!msg.isSent">
                <img [src]="'images/default-men.jpg'" alt="avatar">
              </div>

              <div class="message-wrapper">
                <div class="message" [ngClass]="{'sent': msg.isSent}">
                  {{ msg.text }}
                </div>
                <div class="timestamp">
                  {{ msg.time | date:'shortTime' }}
                </div>
              </div>
            </div>
          </div>

        </div>


        <div class="chat-input">
          <mat-form-field appearance="outline" class="chat-input-field">
            <mat-label>Type message here...</mat-label>
            <input matInput [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
          </mat-form-field>
          <button mat-icon-button color="primary" (click)="sendMessage()" [disabled]="!newMessage">
            <mat-icon>send</mat-icon>
          </button>
        </div>
      </ng-container>
    </div>

  </div>
</div>
